<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>DiseaseLink: Disease Similarity Graph Explorer</title>
		<script src="//use.edgefonts.net/great-primer-small-caps.js"></script>
		<script src="//use.edgefonts.net/dosis.js"></script>
		<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}css/main.css" />
        <script type="text/javascript">
            if(!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1")) {
                alert('The browser you are using is not supported. Please upgrade or use another browser. Chrome or Firefox is recommended.');
                document.execCommand('Stop');
            }
        </script>

		<script src="{{ STATIC_URL }}js/d3.v3.min.js" type="text/javascript"></script>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.js" type="text/javascript"></script>
		<script src="{{ STATIC_URL }}js/json2.js" type="text/javascript"></script>
        <script src="{{ STATIC_URL }}js/jquery.bpopup.min.js"></script>
		<script src="{{ STATIC_URL }}js/graphWithPeripheralLinks.js"></script>
        {% include 'autocomplete_light/static.html' %}
        <script type="text/javascript">
        $(document).ready(function() {
            $('#navigation_autocomplete').yourlabsAutocomplete({
                url: 'navigation_autocomplete',
                choiceSelector: 'div',
            }).input.bind('selectChoice',  function(e, choice, autocomplete) { document.getElementById('navigation_autocomplete').value = choice.text(); })
            .bind('hilightChoice',  function(e, choice, autocomplete) { document.getElementById('navigation_autocomplete').value = choice.text(); });

            $('#working_indicator').css('left', ($(document).width()-$('#working_indicator').width())/2);
            $('#working_indicator').css('top', ($('#middle').height()-$('#working_indicator').height())/2);

            $('#about_popup').width($(document).width()/2);
			$('#about_link').click(function(e) {
				e.preventDefault();
				$('#about_popup').bPopup();
			});

			$('#contact_link').click(function(e) {
				e.preventDefault();
				$('#contact_popup').bPopup();
			});

            $("#contact_form").submit(function(e) {
                e.preventDefault();
                $.ajax({
                    type: "POST",
                    url: "/contact/",
                    data: $(this).serialize(),
                    success: function() {
                        $('#contact_popup').bPopup().close();
                    },
                    error: function() {
                        $('#contact_popup').append('<center>Error sending message.</center>');
                    }
                });
            });
        });
        </script>
	</head>
<body>
<div id="wrapper">

	<section id="header">
		<div id="header-left">
			<div id="header-title"><b>DiseaseLink: disease graph explorer</b></div>
			<form id="inputform" action="graph.do" method="get">
				Search:&nbsp;&nbsp;<input type="text" name="q" id="navigation_autocomplete" style="width: 200px;" value="{{ term }}" />&nbsp;&nbsp;&nbsp;&nbsp;
				Metric:&nbsp;&nbsp;<select name="metric" id="metric_select">
				<option value="cooccurrence">Co-occurrence Conditional Probability</option>
				<option value="similarity">Cosine of Co-occurrence Vectors</option>
				</select>&nbsp;&nbsp;&nbsp;&nbsp;
				# of Nodes:&nbsp;&nbsp;<select name="nodenum" id="nodenum_select">
				<option value="5">5</option>
				<option value="10">10</option>
				<option value="15">15</option>
				<option value="20">20</option>
				<option value="25">25</option>
				<option value="50">50</option>
				</select>&nbsp;&nbsp;&nbsp;&nbsp;
				<input type="submit" value="GRAPH" onclick="document.getElementById('working_indicator').style.visibility='visible';">
			</form>
			<script>
				var metric = '{{ method }}', metric_select = document.getElementById('metric_select');
				for(var i, j = 0; i = metric_select.options[j]; j++) {
					if(i.value == metric) {
						metric_select.selectedIndex = j;
						break;
					}
				}
				var nodenum = '{{ nodes }}', nodenum_select = document.getElementById('nodenum_select');
				for(var m, n = 0; m = nodenum_select.options[n]; n++) {
					if(m.value == nodenum) {
						nodenum_select.selectedIndex = n;
						break;
					}
				}
			</script>
		</div>
	</section>

	<section id="middle">
	            {% if graph %}
                <div id="working_indicator" style="visibility:visible;position:absolute;">Processing . . .<br><img src="{{ STATIC_URL }}images/ajax-loader.gif"></div>
	            {% else %}
                <div id="working_indicator" style="visibility:hidden;position:absolute;">Processing . . .<br><img src="{{ STATIC_URL }}images/ajax-loader.gif"></div>
                {% endif %}

		<div id="container">
			<div id="content"></div>
		</div>

		<aside id="sideLeft">
			{{ keylabel }}<br><br>
			<div id="key"></div>
		</aside>

		<aside id="sideRight">
			Details: <br><br>
			<span id="linkInfo-source">(hover over link)</span>
			<span id="linkInfo-source-num"></span><br>
			<span id="linkInfo-target"></span>
			<span id="linkInfo-target-num"></span><br>
			<span id="linkInfo-coeff"></span>
			<span id="linkInfo-coeff-num"></span><br><br>
		</aside>

	</section>

	<section id="footer">
		<div id="footer-left">
			<a href="#about" id="about_link">More Information</a>&nbsp;&nbsp;<a href="#contact" id="contact_link">Contact</a>
		</div>
		Created by L. Leon Chen &copy; 2013&nbsp;&nbsp;&nbsp;
	</section>

</div>

<div id="about_popup" class="popup">
    <span class="b-close"><span>x</span></span>
    <center><h2>More Information</h2></center>
    <p>The DiseaseLink graph explorer is a visual representation of the relationships shared by diseases and the strengths of these relationships. Nodes represent diseases and link widths represent the strengths of association between them.</p>
    <p>Each graph has a central node from which all other nodes and links are created from. The node sizes and the link widths are all normalized to each graph, so that the actual numerical values may differ from one graph to another.</p>
    <p>In the database are 4,672 diseases or disorders. These are categorized into 27 broad categories, and a disease may fall into one or more of these categories.</p>
    <p>Over 11 million PubMed abstracts were analyzed. The size of the nodes represent how often a disease is mentioned in the literature. Two metrics are used here to calculate the strength of association between two diseases. The first is co-occurrence probability (i.e., given disease X is a topic in an article, what is the conditional probability that disease Y will also be a topic in the same article). The second metric used is the cosine of the co-occurrence probability vectors (in other words, what is the similarity of the co-occurrence <em>links</em> of two diseases).</p>
    <p>This method seeks to capture high-level abstract relationships, with no delineation of the type of relationship. The association link between two diseases may be based on similar presentations, similar pathologic process, similar affected anatomic locations, or any number of relationship types. Two linked diseases may be even causal, but there is no inference of causality or temporality in the graph itself.</p>
    <p>This is not specifically a differential diagnosis tool, nor is it a tool to search for possible comorbidities. I hope you find it interesting and useful. Feedback is always appreciated (click on the Contact button)!</p>
    <!--<p>L. Leon Chen, M.D.<br>Harvard Medical School<br>2013</p>-->
</div>

<div id="contact_popup" class="popup">
    <span class="b-close"><span>x</span></span>
    <center><h2>Contact Me</h2></center>
    <form method="post" id="contact_form">
        Name (optional)<br>
    	<input type="text" name="f_name"><br>
    	Email (optional)<br>
    	<input type="text" name="f_email"><br>
    	Message<br>
    	<textarea rows="10" name="f_message" wrap="physical"></textarea><br>
    	<center><input type="submit" value="Submit" id="submitbutton"></center>
    </form>
</div>

{% if graph %}
{% autoescape off %}
<script>
$(document).ready(function() {
    var termFromTemplate = '{{ term }}';
    var methodFromTemplate = '{{ method }}';
    var nodesFromTemplate = '{{ nodes }}';
    $.get('/getJSONData',
        {
            term: termFromTemplate,
            method: methodFromTemplate,
            nodes: nodesFromTemplate
        },
        function(data) {
            $('#working_indicator').css('visibility', 'hidden');
            graphWithPeripheralLinks(data, termFromTemplate, methodFromTemplate, nodesFromTemplate);
        });
});
</script>
{% endautoescape %}
{% endif %}

</body>
</html>